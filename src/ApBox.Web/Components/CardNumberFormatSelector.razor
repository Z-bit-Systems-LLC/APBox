@using ApBox.Web.Services
@inject CardNumberFormatService FormatService
@implements IDisposable

<Buttons>
    <Buttons Size="Size.ExtraSmall">
        <Button Clicked="() => SetFormat(CardNumberFormat.Decimal)"
                Active="@IsActive(CardNumberFormat.Decimal)"
                ElementId="format-decimal">
            DEC
        </Button>
        <Button Clicked="() => SetFormat(CardNumberFormat.Hexadecimal)"
                Active="@IsActive(CardNumberFormat.Hexadecimal)"
                ElementId="format-hexadecimal">
            HEX
        </Button>
        <Button Clicked="() => SetFormat(CardNumberFormat.Binary)"
                Active="@IsActive(CardNumberFormat.Binary)"
                ElementId="format-binary">
            BIN
        </Button>
    </Buttons>
</Buttons>

@code {
    protected override async Task OnInitializedAsync()
    {
        await FormatService.InitializeAsync();
        FormatService.FormatChanged += OnFormatChanged;
        StateHasChanged();
    }

    private void SetFormat(CardNumberFormat format)
    {
        FormatService.CurrentFormat = format;
    }

    private bool IsActive(CardNumberFormat format)
    {
        return FormatService.CurrentFormat == format;
    }

    private void OnFormatChanged(CardNumberFormat newFormat)
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        if (FormatService != null)
        {
            FormatService.FormatChanged -= OnFormatChanged;
        }
    }
}